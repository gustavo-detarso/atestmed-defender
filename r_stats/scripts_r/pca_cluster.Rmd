---
title: "PCA e Clusterização"
output: html_document
params:
  arquivo: "r_stats/data/dados_analise.csv"
  start_date: "Início"
  end_date: "Fim"
---

```{r setup, include=FALSE}
library(readr)
library(FactoMineR)
library(factoextra)
library(glue)

# Recebe parâmetros do YAML
start_date <- params$start_date
end_date   <- params$end_date

# Caminho robusto para o CSV
csv_path <- params$arquivo
if (!file.exists(csv_path)) {
  csv_alternativo <- file.path("..", "data", basename(csv_path))
  if (file.exists(csv_alternativo)) {
    message(glue("Arquivo CSV não encontrado em {csv_path}. Usando {csv_alternativo}."))
    csv_path <- csv_alternativo
  } else {
    stop(glue("Arquivo CSV não encontrado em {csv_path} nem em {csv_alternativo}"))
  }
}

# Carrega e prepara os dados
df <- read_csv(csv_path) %>%
  select(prod, short_count, nc_ratio, score_final, icra, iatd) %>%
  na.omit()
```
**Período analisado:** `r start_date` até `r end_date`

```{r pca}

res.pca <- PCA(df, graph = FALSE)
fviz_pca_var(res.pca, col.var = "contrib")
```

```{r k-means_clustering}

km <- kmeans(scale(df), centers=3)
fviz_cluster(km, data=scale(df), ellipse.type="euclid")
```
